define(["lodash","jquery","app/plugins/sdk","app/core/app_events","moment"],(function(e,t,n,r,i){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=10)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t,n){var r=n(6);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(8)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(7)(!0)).push([e.i,".small-link a {\n  text-decoration: none;\n  color: #33b5e5; }\n\n.small-link a:hover {\n  text-decoration: underline; }\n\n.small-link .label-tag {\n  background-color: #757575;\n  border-color: #9b9b9b;\n  margin-right: 5px;\n  cursor: context-menu; }\n\n.imgwrap img {\n  width: 100%;\n  height: 100%; }\n\n.imgwrap img:hover {\n  border: 3px solid #33b5e5;\n  cursor: pointer; }\n\n.center-popup {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1050;\n  cursor: pointer; }\n\n.ngtemplate {\n  height: 100%; }\n","",{version:3,sources:["style.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,cAAc,EAAE;;AAElB;EACE,0BAA0B,EAAE;;AAE9B;EACE,yBAAyB;EACzB,qBAAqB;EACrB,iBAAiB;EACjB,oBAAoB,EAAE;;AAExB;EACE,WAAW;EACX,YAAY,EAAE;;AAEhB;EACE,yBAAyB;EACzB,eAAe,EAAE;;AAEnB;EACE,kBAAkB;EAClB,QAAQ;EACR,SAAS;EACT,gCAAgC;EAChC,aAAa;EACb,eAAe,EAAE;;AAEnB;EACE,YAAY,EAAE",file:"style.css",sourcesContent:[".small-link a {\n  text-decoration: none;\n  color: #33b5e5; }\n\n.small-link a:hover {\n  text-decoration: underline; }\n\n.small-link .label-tag {\n  background-color: #757575;\n  border-color: #9b9b9b;\n  margin-right: 5px;\n  cursor: context-menu; }\n\n.imgwrap img {\n  width: 100%;\n  height: 100%; }\n\n.imgwrap img:hover {\n  border: 3px solid #33b5e5;\n  cursor: pointer; }\n\n.center-popup {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1050;\n  cursor: pointer; }\n\n.ngtemplate {\n  height: 100%; }\n"]}])},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=(o=r,a=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(l," */")),s=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot).concat(e," */")}));return[n].concat(s).concat([i]).join("\n")}var o,a,l;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(n,"}"):n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var s=this[i][0];null!=s&&(r[s]=!0)}for(var o=0;o<e.length;o++){var a=e[o];null!=a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="(".concat(a[2],") and (").concat(n,")")),t.push(a))}},t}},function(e,t,n){var r,i,s={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=a.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),p=null,c=0,h=[],u=n(9);function d(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=s[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(y(r.parts[o],t))}else{var a=[];for(o=0;o<r.parts.length;o++)a.push(y(r.parts[o],t));s[r.id]={id:r.id,refs:1,parts:a}}}}function f(e,t){for(var n=[],r={},i=0;i<e.length;i++){var s=e[i],o=t.base?s[0]+t.base:s[0],a={css:s[1],media:s[2],sourceMap:s[3]};r[o]?r[o].parts.push(a):n.push(r[o]={id:o,parts:[a]})}return n}function m(e,t){var n=l(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=h[h.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),h.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=l(e.insertAt.before,n);n.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return b(t,e.attrs),m(e,t),t}function b(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function y(e,t){var n,r,i,s;if(t.transform&&e.css){if(!(s="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=s}if(t.singleton){var o=c++;n=p||(p=v(t)),r=x.bind(null,n,o,!1),i=x.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",b(t,e.attrs),m(e,t),t}(t),r=j.bind(null,n,t),i=function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),r=E.bind(null,n),i=function(){g(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=f(e,t);return d(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var o=n[i];(a=s[o.id]).refs--,r.push(a)}e&&d(f(e,t),t);for(i=0;i<r.length;i++){var a;if(0===(a=r[i]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete s[a.id]}}}};var A,w=(A=[],function(e,t){return A[e]=t,A.filter(Boolean).join("\n")});function x(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=w(t,i);else{var s=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function E(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function j(e,t,n){var r=n.css,i=n.sourceMap,s=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||s)&&(r=u(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([r],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,s=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?e:(i=0===s.indexOf("//")?s:0===s.indexOf("/")?n+s:r+s.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}},function(e,t,n){"use strict";n.r(t);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var i,s=n(2),o=n(1),a=n.n(o),l=n(0),p=n.n(l),c=n(3),h=n.n(c),u=n(4),d=n.n(u),f=(n(5),function(e){this.isProxy=!1,this.withCredentials=!1,this.name=e.name,e.url?this.baseURL=e.url:e.urls&&(this.baseURL=e.urls[0]),this.baseURL||(this.baseURL=""),this.isProxy=this.baseURL.startsWith("/api/"),this.withCredentials=e.withCredentials,this.basicAuth=e.basicAuth});!function(e){e.html="html",e.text="text",e.pre="pre",e.image="image",e.json="json",e.template="template"}(i||(i={}));var m=[{name:"Simple",text:"loads static content from github",config:{request:"http",method:"GET",mode:i.html,template:"",url:"https://raw.githubusercontent.com/ryantxu/ajax-panel/master/static/example.txt",params_js:"{\n from:ctrl.range.from.format('x'),  // x is unix ms timestamp\n to:ctrl.range.to.format('x'), \n height:ctrl.height,\n now:Date.now(),\n interval: ctrl.template('$__interval'),\n sample: 'Not escaped: $__interval',\n since:ctrl.lastRequestTime\n}",header_js:"{}",responseType:"text",withCredentials:!1,skipSameURL:!0,showErrors:!0,showTime:!1,showTimePrefix:null,showTimeFormat:"LTS",showTimeValue:"request",templateResponse:!0}},{name:"Echo Service",text:"Responds with the request attributes",config:{method:"GET",mode:i.json,url:"https://httpbin.org/anything?templateInURL=$__interval",header_js:"{\n  Accept: 'text/plain'\n}",showTime:!0}},{name:"Echo Service with Template",text:"Format the response with an angular template",editorTabIndex:2,config:{method:"GET",mode:i.template,template:"<h5>Origin: {{ response.origin }}</h5>\n\n<pre>{{ response | json }}</pre>",url:"https://httpbin.org/anything?templateInURL=$__interval",header_js:"{\n  Accept: 'text/plain'\n}",showTime:!0}},{name:"Webcamera in Thailand",text:"Load an image dynamically",config:{method:"GET",url:"http://tat.touch-ics.com/CCTV/cam.php?cam=31&datatype=image&langISO=EN&t=current&reloadtime=1",params_js:"{\n __now:Date.now(),\n}",responseType:"arraybuffer",showTime:!0}},{name:"Image",text:'Sending "Accept" header',config:{method:"GET",url:"https://httpbin.org/image",params_js:"{}",header_js:"{\n  Accept: 'image/jpeg'\n}",responseType:"blob",showTime:!0,showTimeValue:"recieve"}},{name:"Image in IFrame",text:"load an image in an iframe",config:{method:"iframe",url:"https://dummyimage.com/600x300/4286f4/000&text=GRAFANA",params_js:"{}"}},{name:"Results from Grafana API",text:"grafana settings api w/ template",config:{mode:i.template,template:'<h2>Instance: {{ response.DEFAULT.instance_name }}</h2>\n\n<div ng-repeat="(key, value) in response">\n\n        <h5>{{key}}</h5>\n\n        <pre>{{ value | json }}</pre>\n\n      </div>',url:"/api/admin/settings",params_js:"{}"}},{name:"Results from Grafana API",text:"formatted as JSON",config:{mode:i.json,url:"/api/admin/stats",params_js:"{}"}},{name:"Basic Auth (success)",text:"send correct basic auth",config:{url:"https://httpbin.org/basic-auth/user/pass",withCredentials:!0,params_js:"{}",header_js:"{\n   Authorization: 'Basic ' + btoa('user' + ':' + 'pass')\n// Authorization: 'Basic dXNlcjpwYXNz'\n}"}},{name:"Basic Auth (fail)",text:"send correct basic auth",config:{url:"https://httpbin.org/basic-auth/userx/passx",withCredentials:!0,params_js:"{}",header_js:"{\n Authorization: 'Basic ...bad..'\n}"}}];n.d(t,"AjaxCtrl",(function(){return g})),n.d(t,"PanelCtrl",(function(){return g}));var g=function(e){function t(t,n,r,i,s,o,a,l,c,h){var u=e.call(this,t,n)||this;return u.$rootScope=r,u.$q=i,u.$timeout=s,u.$sce=o,u.templateSrv=a,u.datasourceSrv=l,u.backendSrv=c,u.$compile=h,u.isIframe=!1,u.objectURL=null,u.scopedVars=null,u.requestCount=0,u.lastRequestTime=-1,u.panel.useDatasource&&(u.panel.request="datasource",delete u.panel.useDatasource),p.a.defaults(u.panel,m[0].config),t.$on("$destroy",(function(){u.objectURL&&URL.revokeObjectURL(u.objectURL)})),u.events.on("data-received",u.onDataReceived.bind(u)),u.events.on("data-snapshot-load",u.onDataSnapshotLoad.bind(u)),u.events.on("data-error",u.onDataError.bind(u)),u.events.on("init-edit-mode",u.onInitEditMode.bind(u)),u.events.on("panel-initialized",u.onPanelInitalized.bind(u)),u.events.on("render",u.notifyWhenRenderingCompleted.bind(u)),u}return t.$inject=["$scope","$injector","$rootScope","$q","$timeout","$sce","templateSrv","datasourceSrv","backendSrv","$compile"],function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.onDataSnapshotLoad=function(e){this.onDataReceived(e)},t.prototype.onDataError=function(e){console.log("onDataError",e)},t.prototype.onDataReceived=function(e){this.process(e),this.loading=!1},t.prototype.notifyWhenRenderingCompleted=function(){var e=this;if(this.timer&&this.$timeout.cancel(this.timer),this.requestCount>0){var t=this.requestCount;this.timer=this.$timeout((function(){e.timer=void 0,e.requestCount===t&&(e.loading?e.notifyWhenRenderingCompleted():e.renderingCompleted())}),100)}},t.prototype.getStaticExamples=function(){return m},t.prototype.isUsingMetricQuery=function(){return this.panel.request.startsWith("query")},t.prototype.loadExample=function(e,t){var n=this;t&&(t.stopPropagation(),t.preventDefault()),console.log("Loading example",e);var r=m[0].config;p.a.forEach(p.a.keys(r),(function(e){delete n.panel[e]})),p.a.defaults(this.panel,e.config),p.a.defaults(this.panel,r),a()(window).scrollTop(0),h.a.emit("dash-scroll",{animate:!1,evt:0}),this.$rootScope.appEvent("alert-success",["Loaded Example Configuraiton",e.name]),e.editorTabIndex?this.editorTabIndex=e.editorTabIndex:this.editorTabIndex=1,this.$scope.response=null,this.updateFN(),this.updateTemplate(),this.refresh()},t.prototype.getCurrentParams=function(e){var t={};return this.paramsFn&&(t=this.paramsFn(this)),t},t.prototype.template=function(e){return e?this.templateSrv.replace(e,this.scopedVars):null},t.prototype.getHeaders=function(e){return this.headerFn?this.headerFn(this):null},t.prototype._getURL=function(e){var t=this.templateSrv.replace(this.panel.url,e),n=this.getCurrentParams();if(n){var r=a.a.param(n);if(r){var i=t.indexOf("?")>0;t=t+(i?"&":"?")+r}}return"datasource"===this.panel.request&&this.dsInfo?this.dsInfo.baseURL+t:t},t.prototype.updateTimeRange=function(t){var n=this.timeInfo,r=e.prototype.updateTimeRange.call(this);return this.panel.showTime&&n&&(this.timeInfo=n),r},t.prototype.issueQueries=function(t){var n=this;if(this.isUsingMetricQuery())return e.prototype.issueQueries.call(this,t);if(this.datasource=t,this.fnError)return this.loading=!1,this.error=this.fnError,null;var r=this.scopedVars=Object.assign({},this.panel.scopedVars,{__interval:{text:this.interval,value:this.interval},__interval_ms:{text:this.intervalMs,value:this.intervalMs}});this.debugParams&&(this.debugParams={},p.a.each(r,(function(e,t){n.debugParams[t]=e.text})),p.a.each(this.templateSrv.variables,(function(e){n.debugParams[e.name]=e.getValueForUrl()})));var i=this._getURL(r);if(this.panel.skipSameURL&&i===this.lastURL)return this.loading=!1,null;this.lastURL=i,this.error=null;var s=Date.now();if(this.isIframe)return this.$scope.url=this.$sce.trustAsResourceUrl(i),void(this.objectURL&&(this.img.css("display","none"),URL.revokeObjectURL(this.objectURL),this.objectURL=null));var o=this.templateSrv.replace(this.panel.url,r),a=this.getCurrentParams(),l={method:this.panel.method,responseType:this.panel.responseType,url:o,params:a,headers:this.getHeaders(),cache:!1,withCredentials:this.panel.withCredentials};l.headers=l.headers||{};var c=Promise.resolve({});if("datasource"===this.panel.request)c=this.datasourceSrv.get(this.panel.datasource).then((function(e){console.log("DDDD",e,n),e?(n.dsInfo=new f(e),(n.dsInfo.basicAuth||n.dsInfo.withCredentials)&&(l.withCredentials=!0),n.dsInfo.basicAuth&&(l.headers.Authorization=n.dsInfo.basicAuth),l.url=n.dsInfo.baseURL+o):n.dsInfo=null}));else{if(!l.url)return this.error="Missing URL",void this.showError(this.error,null);if(l.url.indexOf("://")<0&&l.url.indexOf("api/")<0)return this.error="Invalid URL: "+l.url,void this.showError(this.error,a)}return this.requestCount++,this.loading=!0,c.then((function(){n.backendSrv.datasourceRequest(l).then((function(e){n.lastRequestTime=s,n.process(e),n.loading=!1}),(function(e){console.log("ERR",e),n.lastRequestTime=s,n.loading=!1,n.error=e,n.inspector={error:e},n.showError("Request Error",e)}))})),null},t.prototype.handleQueryResult=function(t){if(this.loading=!1,t&&this.isUsingMetricQuery())return e.prototype.handleQueryResult.call(this,t);this.render()},t.prototype.onPanelInitalized=function(){var e=this;this.updateFN(),this.updateTemplate(),a()(window).on("resize",p.a.debounce((function(t){e.refresh()}),250))},t.prototype.onConfigChanged=function(){this.lastURL=void 0,this.refresh()},t.prototype.onInitEditMode=function(){this.debugParams={},this.addEditorTab("Request","public/plugins/"+this.pluginId+"/partials/editor.request.html",2),this.addEditorTab("Display","public/plugins/"+this.pluginId+"/partials/editor.display.html",3),this.addEditorTab("Examples","public/plugins/"+this.pluginId+"/partials/editor.examples.html",5),this.editorTabIndex=2,this.updateFN()},t.prototype.updateFN=function(){if(this.fnError=null,this.paramsFn=void 0,this.panel.params_js)try{this.paramsFn=new Function("ctrl","return "+this.panel.params_js)}catch(e){console.warn("error parsing params_js",this.panel.params_js,e),this.paramsFn=void 0,this.fnError=e}if(this.panel.header_js)try{this.headerFn=new Function("ctrl","return "+this.panel.header_js)}catch(e){console.warn("error parsing header_js",this.panel.header_js,e),this.headerFn=void 0,this.fnError=e}this.onConfigChanged()},t.prototype.updateTemplate=function(){var e="";if(this.isIframe="iframe"===this.panel.method,this.panel.mode===i.template)this.panel.template||(this.panel.template="<pre>{{ response }}</pre>"),e=this.panel.template;else if(delete this.panel.template,this.isIframe)e='<iframe           frameborder="0"           width="100%"            height="100%"           ng-src="{{ url }}"           ng-if="ctrl.panel.method === \'iframe\'"></iframe>';else{this.panel.mode||(this.panel.mode=i.html);var t=this.panel.mode;switch(t===i.html&&this.isUsingMetricQuery()&&(t=i.pre),t){case i.html:e='<div ng-bind-html="response"></div>';break;case i.text:e="{{ response }}";break;case i.pre:e="<pre>{{ response }}</pre>";break;case i.json:e='<json-tree root-name="sub" object="response" start-expanded="true"></json-tree>';break;case i.image:e="";break;default:console.warn("Unsupported render mode:",this.panel.mode)}}e?(this.ngtemplate.html(e),this.ngtemplate.css("display","block"),this.$compile(this.ngtemplate.contents())(this.$scope)):this.ngtemplate.css("display","none"),this.$scope.response&&this.render()},t.prototype.showError=function(e,t){this.timeInfo=null,this.objectURL&&(this.img.css("display","none"),URL.revokeObjectURL(this.objectURL),this.objectURL=null);var n="<h1>"+e+"</h1>";t&&this.panel.showErrors?n+="<pre>"+JSON.stringify(t)+"</pre>":n+="<pre>Something went wrong while executing your request.</pre>",this.ngtemplate.html(n),this.$compile(this.ngtemplate.contents())(this.$scope),this.$scope.response&&this.render()},t.prototype.process=function(e){if(this.panel.showTime){var t=this.panel.showTimePrefix?this.panel.showTimePrefix:"";if(this.panel.showTimeValue){var n=void 0;if("request"===this.panel.showTimeValue)n=this.lastRequestTime;else if("recieve"===this.panel.showTimeValue)n=Date.now();else if(this.panel.showTimeValue.startsWith("header-")){var r=this.panel.showTimeValue.substring("header-".length),s=e.headers[r];if(s)console.log("TODO, parse header",s,r);else{var o={};for(var a in e.headers())o[a]=e.headers[a];console.log("Header:",r,"not found in:",o,e)}}t+=n?d()(n).format(this.panel.showTimeFormat):"missing: "+this.panel.showTimeValue}this.timeInfo=t}else this.timeInfo=null;if(e){this.$scope.response=e.hasOwnProperty("data")?e.data:e;var l="";if(e.hasOwnProperty("headers")&&(l=e.headers("Content-Type")),l&&l.startsWith("image/")){var p=new Blob([e.data],{type:l}),c=this.objectURL;return this.objectURL=URL.createObjectURL(p),this.img.attr("src",this.objectURL),c&&URL.revokeObjectURL(c),this.img.css("display","block"),void(this.panel.mode!==i.image&&(this.panel.mode=i.image,this.updateTemplate()))}this.objectURL&&(this.img.css("display","none"),URL.revokeObjectURL(this.objectURL),this.objectURL=null),this.panel.mode===i.json&&this.updateTemplate()}},t.prototype.openFullscreen=function(){var e=this;this.overlay.find("img").attr("src",this.objectURL),this.panel.fitImageToScreen?(this.overlay.find("img").css("max-width","98vw"),this.overlay.find("img").css("max-height","98vh")):(this.overlay.find("img").css("max-width",""),this.overlay.find("img").css("max-height","")),a()(".grafana-app").append(this.overlay),this.overlay.on("click",(function(){e.overlay.remove()}))},t.prototype.link=function(e,t,n,r){this.img=a()(t.find("img")[0]),this.ngtemplate=a()(t.find(".ngtemplate")[0]),this.overlay=a()(t.find(".ajaxmodal")[0]),this.overlay.remove(),this.overlay.css("display","block"),this.img.css("display","none")},t.templateUrl="partials/module.html",t.scrollable=!0,t}(s.MetricsPanelCtrl)}])}));